# Numerical Simulations Course: Final Project

Our final project for the 2017/2018 numerical simulations course at the University of Stuttgart.

The objective of this project is the implementation of our previously CPU-based flow solver in OpenCL to exploit the massively parallel architecture of the GPU, ultimatively achieving a speed-up over the CPU-implementation.

To achieve this, multiple kernels have been created, including kernels for
- the initialization of boundary values,
- calculation of the preliminary velocities `F` and `G`,
- the solver for the pressure equation (including the calculation of its right-hand-side),
- calculation of the residual,
- calculation of the new velocities,
- and multiple reduction kernels, used, for example, for the calculation of the residual and the visualization.

Furthermore we re-implemented the visualization using OpenGL.
This lets us use the data directly available on the GPU, thus we can reduce the amount of data copied between device and host.


## Dependencies

This project has the following dependencies:
- OpenCL (calculation)
- OpenGL (visualization)
- SDL2 (window- and OpenGL context-creation)
- GLEW (OpenGL function loading)

As well as dependencies to the following third-party header-only libraries that are included:
- `cl2.hpp` (https://github.com/KhronosGroup/OpenCL-CLHPP) the official OpenCL C++ wrapper
- `json.hpp` (https://github.com/nlohmann/json) to write json files for performance-testing


## Compile and Execute

The program can be compiled using `cmake`, i.e.
```sh
mkdir build && cd build         # create build directory
ccmake ..                       # configure using ccmake
cmake --build .
```

And then executed (in the build directory) using `./main`.
Run `./main -h` for a short info about the available command line options.


## Keyboard Shortcuts

### Interpolation Modifier

| Shortcut      | Effect                             |
|:-------------:|:-----------------------------------|
| <kbd>l</kbd>  | Linear interpolation between cells |
| <kbd>n</kbd>  | Cell values (no interpolation)     |


### Selection of Visualization Data

| Shortcut      | Effect                           |
|:-------------:|:---------------------------------|
| <kbd>1</kbd>  | Display magnitude of velocity    |
| <kbd>2</kbd>  | Display x-velocity (u, centered) |
| <kbd>3</kbd>  | Display y-velocity (v, centered) |
| <kbd>4</kbd>  | Display pressure                 |
| <kbd>5</kbd>  | Display vorticity                |
| <kbd>6</kbd>  | Display stream function          |


### Selection of Intermediate Data for Visualization

| Shortcut       | Effect                                                |
|:--------------:|:------------------------------------------------------|
| <kbd>F1</kbd>  | Display cell x-velocity (u, non-centered)             |
| <kbd>F2</kbd>  | Display cell y-velocity (v, non-centered)             |
| <kbd>F3</kbd>  | Display preliminary cell x-velocity (f, non-centered) |
| <kbd>F4</kbd>  | Display preliminary cell y-velocity (g, non-centered) |
| <kbd>F5</kbd>  | Display right-hand-side of pressure equation          |
| <kbd>F6</kbd>  | Display boundary types                                |


## Parameter Files and Geometry Files

The default parameters and geometry are left unchanged from previous exercise-sheets.
Additionally one can load a parameter and geometry files using

```
./path/to/build/main -p <parameter-file> -g <geometry-file>
```

The syntax of parameter and geometry-files is also left unchanged from the previous exercises, and can, for example, be generated by the `Magrathea` program provided to us in exercise three.


## Validation

For performance-measurements, we used the parameter setting from exercise sheet 1 and the lid-driven-cavity geometry.

To compare performance with the CPU-implementation, we compare runs over different grid-sizes.
If executed in its directory, the python-script `./validation/executor.py` executes the simulation at `../build/main` for multiple grid sizes.
The used grid sizes are 32, 64, 100, 128, 200, 256, 300 in each dimension.
Per default, `*.json` files containing the performance-data are generated and stored in `./data` (relative to the python script).

To compare the error of a pressure-channel-flow to its analytical solution, the command-line-option `--cross-seciton <file>` can be used to obtain u- and v-velocities at a vertical cross-section in the center of the channel.
